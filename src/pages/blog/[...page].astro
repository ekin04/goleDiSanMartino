---
import Cards from "@components/blog/Cards.astro";
import BlogLayout from "layouts/BlogLayout.astro";
import Pagination from "@components/shared/Pagination.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
    const allPost = await getCollection("blog");
    const postOrdinati = allPost.sort(
        (a, b) => b.data.date.getTime() - a.data.date.getTime(),
    );

    const pageSizeFirst = 11;
    const pageSizeOthers = 12;
    const totalPosts = postOrdinati.length;

    const totalPages =
        totalPosts <= pageSizeFirst
            ? 1
            : 1 + Math.ceil((totalPosts - pageSizeFirst) / pageSizeOthers);

    const paths = [];

    for (let i = 1; i <= totalPages; i++) {
        let start, end;
        if (i === 1) {
            start = 0;
            end = pageSizeFirst;
        } else {
            start = pageSizeFirst + (i - 2) * pageSizeOthers;
            end = start + pageSizeOthers;
        }

        const pageData = postOrdinati.slice(start, end);
        const pageNum = i;

        paths.push({
            params: { page: i === 1 ? undefined : i.toString() },
            props: {
                page: {
                    data: pageData,
                    start: start,
                    end: end - 1,
                    size: i === 1 ? pageSizeFirst : pageSizeOthers,
                    total: totalPosts,
                    currentPage: pageNum,
                    lastPage: totalPages,
                    url: {
                        current: i === 1 ? "/blog/" : `/blog/${i}/`,
                        prev:
                            i === 1
                                ? undefined
                                : i === 2
                                  ? "/blog/"
                                  : `/blog/${i - 1}/`,
                        next: i === totalPages ? undefined : `/blog/${i + 1}/`,
                        first: "/blog/",
                        last:
                            totalPages === 1
                                ? "/blog/"
                                : `/blog/${totalPages}/`,
                    },
                },
            },
        });
    }

    return paths;
}

const { page } = Astro.props;
---

<BlogLayout
    titolo="Blog"
    descrizione="Un elenco dei nostri articoli, dove scoprirai nuovi luoghi e nuove esperienze da poter effettuare in Abruzzo"
>
    <section class="bg-white py-16 w-full mt-10 md:mt-16">
        <h2 class="text-4xl font-bold text-center mb-6 text-stone-800">
            Blog & News
        </h2>
        <div class="bg-emerald-600 h-1 w-1/2 mb-6 mx-auto"></div>
        <Pagination page={page} />
        <Cards posts={page.data} isFirstPage={page.currentPage === 1} />
        <Pagination page={page} />
    </section>
</BlogLayout>
